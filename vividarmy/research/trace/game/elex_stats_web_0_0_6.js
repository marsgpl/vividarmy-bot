window.ELEX_APP_VERSION="0.0.5",window.ELEX_APP_ID="999999",window.ELEX_APP_BI_ONOFF=!0,window.ELEX_BI_APP_LOG=!1,window.ELEX_APP_IS_DEVELOP=!0,window.ELEX_APP_ERROR=!0,window.ELEX_APP_STORAGE=!1,window.ELEX_STORAGE_KEY="ELEX_STATS_KEY",window.ELEX_STORAGE_MAX_LENGTH=200,window.ELEX_STORAGE_TIMTS=100,window.ELEX_STATS_UID_AND_OPENID_KEY="ELEX_STATS_UID_AND_OPENID_KEY",window.ELEX_CHECK_HEARTBEAT_TIMTS=100,window.ELEX_APP_BI_CHANNEL_ID="default",window.ELEX_APP_BI_COUNTRY_ID="CN",window.ELEX_APP_BI_PLATFORM_ID="web",window.ELEX_APP_BI_DEVICEOS_ID="",window.ELEX_APP_BI_DEVICEMODEL_ID="",window.ELEX_APP_BI_DEVICEBRAND_ID="",window.ELEX_APP_QUEUE_SPLICE_ONOFF=!0,window.ELEX_APP_QUEUE_SPLICE=10,window.elex_bi_init=function(e){if(null!=e.ELEX_APP_ID&&(window.ELEX_APP_ID=e.ELEX_APP_ID),null!=e.ELEX_APP_BI_ONOFF&&(window.ELEX_APP_BI_ONOFF=e.ELEX_APP_BI_ONOFF),null!=e.ELEX_BI_APP_LOG&&(window.ELEX_BI_APP_LOG=e.ELEX_BI_APP_LOG),null!=e.ELEX_APP_IS_DEVELOP&&(window.ELEX_APP_IS_DEVELOP=e.ELEX_APP_IS_DEVELOP),null!=e.ELEX_APP_STORAGE&&(window.ELEX_APP_STORAGE=e.ELEX_APP_STORAGE),null!=e.ELEX_STORAGE_MAX_LENGTH&&(window.ELEX_STORAGE_MAX_LENGTH=e.ELEX_STORAGE_MAX_LENGTH),null!=e.ELEX_STORAGE_TIMTS&&(window.ELEX_STORAGE_TIMTS=e.ELEX_STORAGE_TIMTS),null!=e.ELEX_APP_BI_CHANNEL_ID&&(window.ELEX_APP_BI_CHANNEL_ID=e.ELEX_APP_BI_CHANNEL_ID),null!=e.ELEX_APP_BI_COUNTRY_ID&&(window.ELEX_APP_BI_COUNTRY_ID=e.ELEX_APP_BI_COUNTRY_ID),null!=e.ELEX_APP_BI_DEVICEOS_ID&&(window.ELEX_APP_BI_DEVICEOS_ID=e.ELEX_APP_BI_DEVICEOS_ID),null!=e.ELEX_APP_BI_DEVICEMODEL_ID&&(window.ELEX_APP_BI_DEVICEMODEL_ID=e.ELEX_APP_BI_DEVICEMODEL_ID),null!=e.ELEX_APP_BI_DEVICEBRAND_ID&&(window.ELEX_APP_BI_DEVICEBRAND_ID=e.ELEX_APP_BI_DEVICEBRAND_ID),null!=e.ELEX_APP_QUEUE_SPLICE&&(window.ELEX_APP_QUEUE_SPLICE=e.ELEX_APP_QUEUE_SPLICE),null!=e.ELEX_APP_QUEUE_SPLICE_ONOFF&&(window.ELEX_APP_QUEUE_SPLICE_ONOFF=e.ELEX_APP_QUEUE_SPLICE_ONOFF),null!=e.ELEX_APP_BI_PLATFORM_ID&&(window.ELEX_APP_BI_PLATFORM_ID=e.ELEX_APP_BI_PLATFORM_ID),e.success){var n={tempId:window.BIUtils.tempId};e.success(n)}var t={TempID:window.BIUtils.tempId,prod:window.ELEX_APP_ID};window.BIUtils.wxpost(window.ELEX_POST_SWITCH_URL,t,function(e){if(null!=e&&null!=e)try{var n=JSON.parse(e);null!=n.ELEX_BI_APP_LOG&&(window.ELEX_BI_APP_LOG=n.ELEX_BI_APP_LOG),null!=n.ELEX_POST_IS_QUEUE&&(window.ELEX_POST_IS_QUEUE=n.ELEX_POST_IS_QUEUE),null!=n.ELEX_POST_FAILE_RETRY&&(window.ELEX_POST_FAILE_RETRY=n.ELEX_POST_FAILE_RETRY),null!=n.ELEX_APP_STORAGE&&(window.ELEX_APP_STORAGE=n.ELEX_APP_STORAGE),null!=n.ELEX_STORAGE_MAX_LENGTH&&(window.ELEX_STORAGE_MAX_LENGTH=n.ELEX_STORAGE_MAX_LENGTH),null!=n.ELEX_STORAGE_TIMTS&&(window.ELEX_STORAGE_TIMTS=n.ELEX_STORAGE_TIMTS),window.ELEX_BI_APP_LOG&&window.BIlog("init switch:",n)}catch(e){window.ELEX_BI_APP_LOG&&window.BIlog("init ELEX_POST_SWITCH_URL catch",e.message)}},null)},window.BIlog=function(e,n){if(null!=e&&"catch"==e){var t={error:n};ELEX_BI.toBI(BI_API.WXChatchError,t)}window.ELEX_BI_APP_LOG&&(null!=n?console.log(e,n):console.log(e))},window.BI_API={Launch:"Launch",LaunchEnd:"LaunchEnd",LoadingStart:"LoadingStart",DownLoadDataTable:"DownLoadDataTable",DownLoadDataTableRet:"DownLoadDataTableRet",DownLoadGameScene:"DownLoadGameScene",DownLoadGameSceneRet:"DownLoadGameSceneRet",LoadingFinish:"LoadingFinish",GetServerInfo:"GetServerInfo",GetServerInfoRet:"GetServerInfoRet",WXLogin:"WXLogin",WXLoginRet:"WXLoginRet",GameServerLogin:"GameServerLogin",GameServerLoginRet:"GameServerLoginRet",EnterGame:"EnterGame",WXShareAppMessagePre:"WXShareAppMessagePre",WXShareAppMessage:"WXShareAppMessage",WXShareAppMessageRet:"WXShareAppMessageRet",PayBefore:"PayBefore",PayBeforeRet:"PayBeforeRet",PayBuy:"PayBuy",PayBuyRet:"PayBuyRet",PayMidas:"PayMidas",PayMidasRet:"PayMidasRet",PayCancel:"PayCancel",PayCancelRet:"PayCancelRet",SeeVideo:"SeeVideo",SeeVideoRet:"SeeVideoRet",SeeVideoPre:"SeeVideoPre",UiOpen:"UiOpen",UiOpenRet:"UiOpenRet",UiClose:"UiClose",gotoOther:"gotoOther",gotoOtherRet:"gotoOtherRet",gotoOtherCancel:"gotoOtherCancel",gotoOtherTAP:"gotoOtherTAP",NewUserGuide:"NewUserGuide",DoTask:"DoTask",CustomEvent:"CustomEvent",test:"test",WXOnShow:"WXOnShow",WXonError:"WXonError",WXChatchError:"WXChatchError",GameError:"GameError"},window.BI_API=window.BI_API;var ElexBiQueue=function(){function e(e){this.elements=new Array,this._size=e}return e.prototype.push=function(e){return null!=e&&(null==this._size||isNaN(this._size)||this.elements.length==this._size&&this.pop(),this.elements.unshift(e),!0)},e.prototype.pop=function(){return this.elements.pop()},e.prototype.size=function(){return this.elements.length},e.prototype.empty=function(){return 0==this.size()},e.prototype.clear=function(){delete this.elements,this.elements=new Array},e.prototype.concat=function(e){for(var n in e)this.push(n)},e.prototype.splice=function(){var e=0,n=window.ELEX_APP_QUEUE_SPLICE;return this.elements.length>n?e=this.elements.length-n:n=this.elements.length,this.elements.splice(e,n)},e}();window.ElexBiQueue=ElexBiQueue,window.ELEX_POST_IS_QUEUE=!0,window.ELEX_POST_OVERTIME=1e4,window.ELEX_POST_FAILE_RETRY=10,window.ELEX_POST_URL="https://public-bi-us.rivergame.net/client/loading",window.ELEX_POST_SWITCH_URL="https://bisdk.rivergame.net/clientloading_switch.php";var ElexBiHttpUtils=function(){function e(){this.queue=new ElexBiQueue,this.tempId=this.guid()+""+this.guid(),this.storageTime=0,this.onHiedTimes=0,this.blockHeartbeatTimes=0,this.nowSendPack=new Array,setInterval(this.checkQueue,100)}return e.getInstance=function(){return null==e._instance&&(this._instance=new e),e._instance},e.prototype.guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=16*Math.random()|0,t="x"==e?n:3&n|8;return t.toString(16)})},e.prototype.clearSendPack=function(){delete this.nowSendPack,this.nowSendPack=new Array},e.prototype.sendUtils=function(e){try{window.ELEX_BI_APP_LOG&&window.BIlog("BI send post:",JSON.stringify(e)),window.ELEX_POST_IS_QUEUE&&(window.ELEX_BI_APP_LOG&&window.BIlog("add queue"),this.queue.push(e))}catch(e){window.ELEX_BI_APP_LOG&&window.BIlog("catch",e.message)}},e.prototype.checkQueue=function(){var e=window.BIUtils;null!=e&&null!=e?(e.checkStorageAddQueue(),window.ELEX_APP_QUEUE_SPLICE_ONOFF?e.checkQueuePack():e.checkQueueOne()):window.ELEX_BI_APP_LOG&&window.BIlog("bi send post fail BIUtils undefined")},e.prototype.checkQueuePack=function(){try{for(;BIUtils.queue.size()>0;){window.BIlog("BIUtils queue:",BIUtils.queue),BIUtils.blockHeartbeatTimes=0,BIUtils.clearSendPack();var e=BIUtils.queue.splice();if(0!=e.launch){window.BIlog("BIUtils nowSendPack:",e),BIUtils.nowSendPack=BIUtils.nowSendPack.concat(e);var n={paramsList:JSON.stringify(e)};BIUtils.wxpost(window.ELEX_POST_URL,n,BIUtils.successHandler,BIUtils.failHandler);break}}}catch(e){window.BIlog("catch",e.message)}},e.prototype.checkQueueOne=function(){try{for(;BIUtils.queue.size()>0;){window.ELEX_BI_APP_LOG&&window.BIlog("BIUtils queue:",BIUtils.queue),BIUtils.blockHeartbeatTimes=0;var e=BIUtils.queue.pop();if(e&&e.ext){var n=JSON.parse(e.ext);if(n.retryNum>=window.ELEX_POST_FAILE_RETRY){window.ELEX_BI_APP_LOG&&window.BIlog("ext retryNum",n.retryNum);continue}}BIUtils.wxpost(window.ELEX_POST_URL,e,BIUtils.successHandler,BIUtils.failHandler);break}}catch(e){window.ELEX_BI_APP_LOG&&window.BIlog("catch",e.message)}},e.prototype.checkOnHide=function(){var e=window.BIUtils;null!=e&&null!=e?(this.onHiedTimes+=1,this.onHiedTimes>=50&&(this.onHiedTimes=0,ELEX_BI.toBI("Hide",{}))):window.ELEX_BI_APP_LOG&&window.BIlog("checkOnHide",e)},e.prototype.checkStorageAddQueue=function(){if(window.ELEX_APP_STORAGE){var e=window.BIUtils;if(null!=e&&null!=e){if(this.storageTime+=1,this.storageTime>=window.ELEX_STORAGE_TIMTS){this.storageTime=0;try{var n=window.ELEX_STORAGE.getStorageSync();for(window.ELEX_BI_APP_LOG&&window.BIlog("数据缓存：10秒心跳处理",n);n.length>0;){var t=n.pop();e.queue.push(t)}}catch(e){window.ELEX_BI_APP_LOG&&window.BIlog("checkStorageAddQueue catch",e.message)}}}else window.ELEX_BI_APP_LOG&&window.BIlog("checkStorageAddQueue",e)}},e.prototype.successHandler=function(e){if("fail"!=e){window.ELEX_BI_APP_LOG&&window.BIlog("bi send post success",e);var n=window.BIUtils;null!=n&&null!=n?window.ELEX_APP_QUEUE_SPLICE_ONOFF&&n.clearSendPack():window.ELEX_BI_APP_LOG&&window.BIlog("bi send post fail BIUtils undefined",n)}else window.ELEX_BI_APP_LOG&&window.BIlog("bi send post fail")},e.prototype.failHandler=function(e,n){window.ELEX_BI_APP_LOG&&window.BIlog("bi send post fail",JSON.stringify(n));var t=window.BIUtils;null!=t&&null!=t?window.ELEX_APP_QUEUE_SPLICE_ONOFF?t.failHandlerPack():t.failHandlerOne():window.ELEX_BI_APP_LOG&&window.BIlog("bi send post fail BIUtils undefined")},e.prototype.failHandlerPack=function(e){try{if(null==BIUtils.nowSendPack||0==BIUtils.nowSendPack.length)return;for(var n in window.BIlog("failHandlerPack ext ext begin"),BIUtils.nowSendPack){var t=BIUtils.nowSendPack[n],i=JSON.parse(t.ext);window.BIlog("failHandlerPack ext ext",i),i.statusCode=408,i.retryNum+=1,i.retryNum>=window.ELEX_POST_FAILE_RETRY?(window.ELEX_STORAGE.setStorageSync(t),window.BIlog("failHandlerPack ext retryNum",i.retryNum)):(t.ext=JSON.stringify(i),BIUtils.queue.push(t))}window.BIlog("failHandlerPack ext ext end")}catch(e){window.BIlog("catch",e.message)}},e.prototype.failHandlerOne=function(e){try{var n=JSON.parse(params.ext);n.statusCode=null==e||""==e||null==e?0:408,n.retryNum+=1,n.retryNum>=window.ELEX_POST_FAILE_RETRY?(window.ELEX_STORAGE.setStorageSync(params),window.ELEX_BI_APP_LOG&&window.BIlog("failHandler ext retryNum",n.retryNum)):(params.ext=JSON.stringify(n),BIUtils.queue.push(params))}catch(e){window.ELEX_BI_APP_LOG&&window.BIlog("catch",e.message)}},e.prototype.postChecker=function(e){if("object"!=typeof e)return"";var n=new Array,t=0;for(var i in e)n[t]=i+"="+encodeURIComponent(e[i]),t++;return n.join("&")},e.prototype.wxpost=function(e,n,t,i){this.post(e,n,t,i)},e.prototype.post=function(e,n,t,i){try{var o=cc.loader.getXMLHttpRequest();o.onerror=function(e){window.ELEX_BI_APP_LOG&&window.BIlog("elex bi onerror",e)},o.ontimeout=function(e){window.ELEX_BI_APP_LOG&&window.BIlog("elex bi post timeout!!",e),4!==o.readyState&&i&&i(JSON.stringify(o.responseText),n)},o.onreadystatechange=function(){window.ELEX_BI_APP_LOG&&window.BIlog("elex bi onreadystatechange readyState",o.readyState),4==o.readyState&&(window.ELEX_BI_APP_LOG&&window.BIlog("elex bi onreadystatechange responseText",JSON.stringify(o.responseText)),o.status>=200&&o.status<400?t&&t(JSON.stringify(o.responseText)):i&&i(JSON.stringify(o.responseText),n))},o.open("POST",e,!0),o.timeout=window.ELEX_POST_OVERTIME,o.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var E=this.postChecker(n);o.send(E)}catch(e){window.ELEX_BI_APP_LOG&&window.BIlog("elex bi post error:",e.message)}},e._instance=null,e}();window.BIUtils=ElexBiHttpUtils.getInstance(),window.BIUtils=window.BIUtils;var ElexBiManager=function(){function e(){this.uid="",this.openid="",this.version="",this.connection="",this.unionid="",this.level=0,this.networkstatus="-1",this.tempId=window.BIUtils.tempId,this.userinfo=null,this.beginGameTime=0,this.lastShowGameTime=0,this.lastHideGameTime=0,this.cumulastGideGameTime=0,this.index=0}return e.getInstance=function(){return null==e._instance&&(this._instance=new e),e._instance},e.prototype.updateGameBiInfo=function(e,n,t,i,o){null!=e&&null!=e&&(this.uid=e),null!=n&&null!=n&&(this.openid=n),null!=t&&null!=t&&(this.version=t),null!=i&&null!=i&&(this.connection=i),null!=o&&null!=o&&(this.unionid=o)},e.prototype.updateInit=function(e){null==e&&(e={}),window.elex_bi_init(e),cc.sys.localStorage.removeItem("ELEX_STATS_UID_AND_OPENID_KEY")},e.prototype.onBeginGame=function(){this.beginGameTime=(new Date).getTime()},e.prototype.onHideFunc=function(e){ELEX_BI.lastHideGameTime=(new Date).getTime(),window.ELEX_BI_APP_LOG&&window.BIlog("onHideFunc")},e.prototype.onShowFunc=function(e){if(ELEX_BI.lastShowGameTime=(new Date).getTime(),ELEX_BI.cumulastGideGameTime+=ELEX_BI.lastShowGameTime>ELEX_BI.lastHideGameTime&&0!=ELEX_BI.lastHideGameTime?ELEX_BI.lastShowGameTime-ELEX_BI.lastHideGameTime:0,ELEX_BI.lastHideGameTime=0,ELEX_BI.toBI(BI_API.WXOnShow),window.ELEX_BI_APP_LOG&&window.BIlog("onShowFunc"),window.ELEX_APP_STORAGE)try{var n=window.ELEX_STORAGE.getStorageSync();for(window.ELEX_BI_APP_LOG&&window.BIlog("数据缓存：onShow处理",n.length);n.length>0;){var t=n.pop();BIUtils.queue.push(t)}}catch(e){window.ELEX_BI_APP_LOG&&window.BIlog("onShowFunc catch",e.message)}},e.prototype.sendHttpPost=function(e,n){this.index+=1;var t={};""==this.uid&&""!=window.ELEX_STORAGE.localUid?t.uid=window.ELEX_STORAGE.localUid:t.uid=this.uid,null==t.uid&&(t.uid=""),""==this.openid&&""!=window.ELEX_STORAGE.localOpenid?t.openid=window.ELEX_STORAGE.localOpenid:t.openid=this.openid,null==t.openid&&(t.openid=""),""==this.connection&&""!=window.ELEX_STORAGE.localConnection?t.connection=window.ELEX_STORAGE.localConnection:t.connection=this.connection,null==t.connection&&(t.connection=""),t.country=window.ELEX_APP_BI_COUNTRY_ID,t.ip="",t.version=this.version,t.platform=window.ELEX_APP_BI_PLATFORM_ID,t.step=e,t.networkstatus=this.networkstatus,t.unionid=this.unionid,t.prod=window.ELEX_APP_ID,t.queueNum=this.index,null==n&&(n={}),n.index=this.index,n.retryNum=0,n.storage=0,n.statusCode=0;var i=(new Date).getTime();n.Time=i-this.beginGameTime-this.cumulastGideGameTime,n.TempID=this.tempId,n.sdkVersion=window.ELEX_APP_VERSION,n.sdkVersionName="js_web",n.adid=window.ELEX_APP_BI_CHANNEL_ID,window.ELEX_APP_QUEUE_SPLICE_ONOFF&&(n.packMsg=1),window.ELEX_APP_IS_DEVELOP?n.evn="debug":n.evn="release";var o=JSON.stringify(n);t.ext=o,window.ELEX_APP_BI_ONOFF&&window.BIUtils.sendUtils(t)},e.prototype.toBI=function(e,n){if(null==n&&(n={}),e!=window.BI_API.Launch){e==window.BI_API.GameServerLogin?this.onGameServerLoginInit():e==window.BI_API.EnterGame?this.onEnterGameInit(n):e==window.BI_API.GameError&&this.onGameError(n);var t=JSON.parse(JSON.stringify(n));this.sendHttpPost(e,t)}else this.onLaunch()},e.prototype.onGameServerLoginInit=function(){},e.prototype.onEnterGameInit=function(e){window.ELEX_STORAGE.setStorageUidAndOpendid(this.uid,this.openid,this.connection)},e.prototype.onGameError=function(e){if(null!=e.errMsgInfo&&""!=e.errMsgInfo){var n=e.errMsgInfo,t=n.replace(/"/g,"|");e.errMsgInfo=t}},e.prototype.onRequestError=function(e){if(null!=e.errMsg&&""!=e.errMsg){var n=e.errMsg,t=n.replace(/"/g,"|");e.errMsg=t}},e.prototype.onLaunch=function(){this.onBeginGame(),window.ELEX_STORAGE.getStorageUidAndOpendid(),cc.game.on(cc.game.EVENT_HIDE,function(){window.ELEX_BI.onHideFunc()},this),cc.game.on(cc.game.EVENT_SHOW,function(){window.ELEX_BI.onShowFunc()},this),window.ELEX_BI_APP_LOG&&window.BIlog("sys.getNetworkType:",cc.sys.getNetworkType());try{this.networkstatus=cc.sys.getNetworkType();var e={},n={};n.os=window.ELEX_APP_BI_DEVICEOS_ID,n.brand=window.ELEX_APP_BI_DEVICEBRAND_ID,n.model=window.ELEX_APP_BI_DEVICEMODEL_ID,e.systeminfo=n,this.sendHttpPost(window.BI_API.Launch,e)}catch(e){window.ELEX_BI_APP_LOG&&window.BIlog("catch",e.message)}},e._instance=null,e}();window.ELEX_BI=ElexBiManager.getInstance(),window.ELEX_BI=window.ELEX_BI;var ElexWxStorage=function(){function e(){this.valueList=new Array,this.localUid="",this.localOpenid="",this.localConnection="",this.getStorageUidAndOpendid()}return e.getInstance=function(){return null==e._instance&&(e._instance=new e),e._instance},e.prototype.getStorageSync=function(){if(!window.ELEX_APP_STORAGE)return new Array;try{var e=cc.sys.localStorage.getItem(window.ELEX_STORAGE_KEY);if(e)return JSON.parse(e)}catch(e){window.ELEX_BI_APP_LOG&&window.BIlog("get getStorageSync error",e.message)}return new Array},e.prototype.setStorageSync=function(e){if(window.ELEX_APP_STORAGE){window.ELEX_BI_APP_LOG&&window.BIlog("数据缓存：失败单条插入",e);try{var n=JSON.parse(e.ext);n&&(n.storage+=1,n.retryNum=0,e.ext=JSON.stringify(n)),this.valueList=this.getStorageSync(),this.valueList.length<window.ELEX_STORAGE_MAX_LENGTH&&(this.valueList.unshift(e),cc.sys.localStorage.setItem(window.ELEX_STORAGE_KEY,JSON.stringify(this.valueList)))}catch(e){window.ELEX_BI_APP_LOG&&window.BIlog("get setStorageSync error",e.message)}}},e.prototype.setStorageUidAndOpendid=function(e,n,t){try{var i={localUid:e,localOpenid:n,localConnection:t};this.localUid=e,this.localOpenid=n,this.localConnection=t,cc.sys.localStorage.setItem(window.ELEX_STATS_UID_AND_OPENID_KEY,JSON.stringify(i)),window.ELEX_BI_APP_LOG&&window.BIlog("setStorageUidAndOpendid value:",i)}catch(e){window.ELEX_BI_APP_LOG&&window.BIlog("setStorageUidAndOpendid error",e.message)}},e.prototype.getStorageUidAndOpendid=function(){try{var e=cc.sys.localStorage.getItem(window.ELEX_STATS_UID_AND_OPENID_KEY),n=JSON.parse(e);n&&(this.localUid=n.localUid,this.localOpenid=n.localOpenid,this.localConnection=n.localConnection),window.ELEX_BI_APP_LOG&&window.BIlog("getStorageUidAndOpendid value:",n)}catch(e){window.ELEX_BI_APP_LOG&&window.BIlog("getStorageUidAndOpendid error",e)}},e._instance=null,e}();window.ELEX_STORAGE=ElexWxStorage.getInstance();