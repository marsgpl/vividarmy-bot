import { DiscordBot } from 'DiscordBot';
import * as GAME_WS_FIELDS from 'constants/gameWsFields';
import * as GAME_WS_COMMANDS from 'constants/gameWsCommands';

// {"c":650,"o":"65","p":{"start":30,"end":59}}
// {"c":650,"s":0,"d":"{\"rank\":11820,\"list\":[{\"uid\":\"306931708505\",\"worldId\":8,\"showCareerId\":1205002,\"playerInfo\":\"{\\\"nationalflag\\\":233,\\\"gender\\\":0,\\\"avatarurl\\\":null,\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":1,\\\"headimgurl_custom\\\":\\\"https://knight-cdn.akamaized.net/headimg/306931708505.jpg?v=1600565988187\\\",\\\"username\\\":\\\"DoomStar\\\"}\",\"power\":\"3.30807180709817E28\"},{\"uid\":\"306792075865\",\"worldId\":1,\"showCareerId\":1204002,\"playerInfo\":\"{\\\"nationalflag\\\":43,\\\"gender\\\":0,\\\"avatarurl\\\":\\\"headIcon_5_1\\\",\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":0,\\\"username\\\":\\\"Valery\\\"}\",\"power\":\"1.642578987331582E28\"},{\"uid\":\"307092894297\",\"worldId\":35,\"showCareerId\":1002804,\"playerInfo\":\"{\\\"nationalflag\\\":114,\\\"gender\\\":0,\\\"avatarurl\\\":\\\"hero_icon212\\\",\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":1,\\\"username\\\":\\\"Zena\\\"}\",\"power\":\"6.428147480875182E27\"},{\"uid\":\"307176813145\",\"worldId\":27,\"showCareerId\":1002702,\"playerInfo\":\"{\\\"nationalflag\\\":167,\\\"gender\\\":0,\\\"avatarurl\\\":\\\"\\\",\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":1,\\\"headimgurl_custom\\\":\\\"https://knight-cdn.akamaized.net/headimg/307176813145.jpg?v=1599590746605\\\",\\\"username\\\":\\\"Swenor\\\"}\",\"power\":\"1.787550122977677E27\"},{\"uid\":\"307427955289\",\"worldId\":8,\"showCareerId\":1002705,\"playerInfo\":\"{\\\"nationalflag\\\":233,\\\"gender\\\":0,\\\"avatarurl\\\":null,\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":0,\\\"headimgurl_custom\\\":\\\"https://knight-cdn.akamaized.net/headimg/307427955289.jpg?v=1601505214947\\\",\\\"username\\\":\\\"NoMercy\\\"}\",\"power\":\"1.6891538138760704E27\"},{\"uid\":\"306822369881\",\"worldId\":17,\"showCareerId\":1002903,\"playerInfo\":\"{\\\"nationalflag\\\":84,\\\"gender\\\":0,\\\"avatarurl\\\":\\\"\\\",\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":2,\\\"headimgurl_custom\\\":\\\"https://knight-cdn.akamaized.net/headimg/306822369881.jpg?v=1600028198827\\\",\\\"username\\\":\\\"Füriend\\\"}\",\"power\":\"1.6556970810403177E27\"},{\"uid\":\"306982937177\",\"worldId\":8,\"showCareerId\":1204003,\"playerInfo\":\"{\\\"nationalflag\\\":233,\\\"gender\\\":0,\\\"avatarurl\\\":\\\"hero_icon011_global\\\",\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":1,\\\"headimgurl_custom\\\":\\\"https://knight-cdn.akamaized.net/headimg/306982937177.jpg?v=1597711329742\\\",\\\"username\\\":\\\"Deven\\\"}\",\"power\":\"1.1489619348773351E27\"},{\"uid\":\"306796216921\",\"worldId\":1,\"showCareerId\":1012906,\"playerInfo\":\"{\\\"nationalflag\\\":114,\\\"gender\\\":0,\\\"avatarurl\\\":\\\"hero_icon1309\\\",\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":0,\\\"username\\\":\\\"RD\\\"}\",\"power\":\"5.826080466467995E26\"},{\"uid\":\"307403776601\",\"worldId\":8,\"showCareerId\":1002706,\"playerInfo\":\"{\\\"nationalflag\\\":233,\\\"gender\\\":0,\\\"avatarurl\\\":\\\"\\\",\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":1,\\\"headimgurl_custom\\\":\\\"https://knight-cdn.akamaized.net/headimg/307403776601.jpg?v=1601302612842\\\",\\\"username\\\":\\\"PZ\\\"}\",\"power\":\"5.780622195312422E26\"},{\"uid\":\"306806772313\",\"worldId\":1,\"showCareerId\":1013005,\"playerInfo\":\"{\\\"nationalflag\\\":114,\\\"gender\\\":0,\\\"avatarurl\\\":\\\"headIcon_21_1\\\",\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":0,\\\"username\\\":\\\"KG2020\\\"}\",\"power\":\"5.772818936811366E26\"},{\"uid\":\"307168473689\",\"worldId\":8,\"showCareerId\":1002705,\"playerInfo\":\"{\\\"nationalflag\\\":233,\\\"gender\\\":0,\\\"avatarurl\\\":\\\"\\\",\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":1,\\\"headimgurl_custom\\\":\\\"https://knight-cdn.akamaized.net/headimg/307168473689.jpg?v=1597738197836\\\",\\\"username\\\":\\\"laddu\\\"}\",\"power\":\"1.684045380804151E26\"},{\"uid\":\"307088962137\",\"worldId\":28,\"showCareerId\":1002702,\"playerInfo\":\"{\\\"nationalflag\\\":233,\\\"gender\\\":0,\\\"avatarurl\\\":null,\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":1,\\\"headimgurl_custom\\\":\\\"https://knight-cdn.akamaized.net/headimg/307088962137.jpg?v=1599865644198\\\",\\\"username\\\":\\\"BudLight\\\"}\",\"power\":\"1.6492796791134182E26\"},{\"uid\":\"307154764377\",\"worldId\":2,\"showCareerId\":1012904,\"playerInfo\":\"{\\\"nationalflag\\\":157,\\\"gender\\\":0,\\\"avatarurl\\\":\\\"\\\",\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":1,\\\"headimgurl_custom\\\":\\\"https://knight-cdn.akamaized.net/headimg/307154764377.jpg?v=1600659101621\\\",\\\"username\\\":\\\"Manuu\\\"}\",\"power\":\"1.5110393090981733E26\"},{\"uid\":\"306792886873\",\"worldId\":56,\"showCareerId\":1002804,\"playerInfo\":\"{\\\"nationalflag\\\":77,\\\"gender\\\":0,\\\"avatarurl\\\":null,\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":1,\\\"headimgurl_custom\\\":\\\"https://knight-cdn.akamaized.net/headimg/306792886873.jpg?v=1594932927617\\\",\\\"username\\\":\\\"Kokhou\\\"}\",\"power\":\"1.4767784881857332E26\"},{\"uid\":\"307036336729\",\"worldId\":6,\"showCareerId\":1002703,\"playerInfo\":\"{\\\"nationalflag\\\":31,\\\"gender\\\":0,\\\"avatarurl\\\":\\\"icon_man02_1\\\",\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":1,\\\"username\\\":\\\"Dj\\\"}\",\"power\":\"1.4047326946229058E26\"},{\"uid\":\"306972566105\",\"worldId\":1,\"showCareerId\":1002702,\"playerInfo\":\"{\\\"nationalflag\\\":43,\\\"gender\\\":0,\\\"avatarurl\\\":\\\"\\\",\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":0,\\\"headimgurl_custom\\\":\\\"https://knight-cdn.akamaized.net/headimg/306972566105.jpg?v=1600286948971\\\",\\\"username\\\":\\\"♠️Inked♠\\\"}\",\"power\":\"1.107827630991744E26\"},{\"uid\":\"307344822873\",\"worldId\":8,\"showCareerId\":1013004,\"playerInfo\":\"{\\\"nationalflag\\\":233,\\\"gender\\\":0,\\\"avatarurl\\\":\\\"\\\",\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":0,\\\"headimgurl_custom\\\":\\\"https://knight-cdn.akamaized.net/headimg/307344822873.jpg?v=1601512650243\\\",\\\"username\\\":\\\"Kimozzz\\\"}\",\"power\":\"9.095881612214365E25\"},{\"uid\":\"307009049177\",\"worldId\":1,\"showCareerId\":1012904,\"playerInfo\":\"{\\\"nationalflag\\\":75,\\\"gender\\\":0,\\\"avatarurl\\\":\\\"\\\",\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":1,\\\"headimgurl_custom\\\":\\\"https://knight-cdn.akamaized.net/headimg/307009049177.jpg?v=1599853054963\\\",\\\"username\\\":\\\"Luxor\\\"}\",\"power\":\"3.692458084146548E25\"},{\"uid\":\"306813235801\",\"worldId\":53,\"showCareerId\":1002705,\"playerInfo\":\"{\\\"nationalflag\\\":114,\\\"gender\\\":0,\\\"avatarurl\\\":\\\"hero_icon2058_nui\\\",\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":0,\\\"username\\\":\\\"彡⌒ミ\\\"}\",\"power\":\"3.668309712498855E25\"},{\"uid\":\"308082582105\",\"worldId\":8,\"showCareerId\":1002704,\"playerInfo\":\"{\\\"nationalflag\\\":233,\\\"gender\\\":0,\\\"avatarurl\\\":\\\"\\\",\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":1,\\\"headimgurl_custom\\\":\\\"https://knight-cdn.akamaized.net/headimg/308082582105.jpg?v=1600361842640\\\",\\\"username\\\":\\\"godzilla\\\"}\",\"power\":\"3.6537718574242406E25\"},{\"uid\":\"307037876825\",\"worldId\":23,\"showCareerId\":1002704,\"playerInfo\":\"{\\\"nationalflag\\\":114,\\\"gender\\\":0,\\\"avatarurl\\\":\\\"hero_icon109\\\",\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":1,\\\"username\\\":\\\"太郎\\\"}\",\"power\":\"3.463189663555474E25\"},{\"uid\":\"307214221913\",\"worldId\":54,\"showCareerId\":1002702,\"playerInfo\":\"{\\\"nationalflag\\\":57,\\\"gender\\\":0,\\\"avatarurl\\\":null,\\\"nickname\\\":null,\\\"headimgurl\\\":\\\"\\\",\\\"usergender\\\":1,\\\"headimgurl_custom\\\":\\\"https://knight-cdn.akamaized.net/headimg/307214221913.jpg?v=1601314395011\\\",\\\"username\\\":\\\"TheBrain\\\"}\",\"power\":\"3.370056529483742E25\"},{\"uid\":\"307344921177\",\"worldId\":8,\"showCareerId\":1002802,\"playerInfo\":\"{\\\"nationalflag\\\":233,\\\"gender\\\":0,\\\"avatarurl\\\":\\\"\\\",\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":1,\\\"headimgurl_custom\\\":\\\"https://knight-cdn.akamaized.net/headimg/307344921177.jpg?v=1597262500743\\\",\\\"username\\\":\\\"HoLeChit\\\"}\",\"power\":\"3.3043549433801596E25\"},{\"uid\":\"306997932633\",\"worldId\":38,\"showCareerId\":1002604,\"playerInfo\":\"{\\\"nationalflag\\\":184,\\\"gender\\\":0,\\\"avatarurl\\\":\\\"\\\",\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":1,\\\"headimgurl_custom\\\":\\\"https://knight-cdn.akamaized.net/headimg/306997932633.jpg?v=1599536317933\\\",\\\"username\\\":\\\"ᛚᚨᚲᛁ\\\"}\",\"power\":\"3.0772777575201514E25\"},{\"uid\":\"307067265625\",\"worldId\":31,\"showCareerId\":1013003,\"playerInfo\":\"{\\\"nationalflag\\\":114,\\\"gender\\\":0,\\\"avatarurl\\\":\\\"hero_icon2049_vtb\\\",\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":0,\\\"username\\\":\\\"白狐\\\"}\",\"power\":\"2.9623151254379403E25\"},{\"uid\":\"306882118233\",\"worldId\":6,\"showCareerId\":1002703,\"playerInfo\":\"{\\\"nationalflag\\\":31,\\\"gender\\\":0,\\\"avatarurl\\\":\\\"\\\",\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":1,\\\"headimgurl_custom\\\":\\\"https://knight-cdn.akamaized.net/headimg/306882118233.jpg?v=1599866084199\\\",\\\"username\\\":\\\"COMANDOS\\\"}\",\"power\":\"2.935738109129657E25\"},{\"uid\":\"307203621465\",\"worldId\":1,\"showCareerId\":1013004,\"playerInfo\":\"{\\\"nationalflag\\\":114,\\\"gender\\\":0,\\\"avatarurl\\\":\\\"hero_icon001_summer\\\",\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":1,\\\"username\\\":\\\"もも\\\"}\",\"power\":\"2.900302087385284E25\"},{\"uid\":\"307784372825\",\"worldId\":5,\"showCareerId\":1002704,\"playerInfo\":\"{\\\"nationalflag\\\":203,\\\"gender\\\":0,\\\"avatarurl\\\":\\\"hero_icon006_summer\\\",\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":1,\\\"username\\\":\\\"ObiWanK\\\"}\",\"power\":\"2.0296298060379484E25\"},{\"uid\":\"307302056537\",\"worldId\":1,\"showCareerId\":1002704,\"playerInfo\":\"{\\\"nationalflag\\\":31,\\\"gender\\\":0,\\\"avatarurl\\\":\\\"\\\",\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":1,\\\"headimgurl_custom\\\":\\\"https://knight-cdn.akamaized.net/headimg/307302056537.jpg?v=1600008293072\\\",\\\"username\\\":\\\"Morning✨\\\"}\",\"power\":\"1.8028667427706433E25\"},{\"uid\":\"307408020057\",\"worldId\":1,\"showCareerId\":1002705,\"playerInfo\":\"{\\\"nationalflag\\\":233,\\\"gender\\\":0,\\\"avatarurl\\\":\\\"hero_icon110_global\\\",\\\"nickname\\\":null,\\\"headimgurl\\\":null,\\\"usergender\\\":1,\\\"headimgurl_custom\\\":\\\"https://knight-cdn.akamaized.net/headimg/307408020057.jpg?v=1595604348591\\\",\\\"username\\\":\\\"Truefury\\\"}\",\"power\":\"1.6977026176315944E25\"}]}","o":"61"}

export interface Options {
    uid: string;
}

export default function(
    bot: DiscordBot,
    start: number,
    end: number,
): Promise<any> { return new Promise((resolve, reject) => {
    if (!bot.state) throw Error('no state');

    const { config, state } = bot;
    const { game } = state;

    if (!game.gameWs) throw Error('no gameWs');

    const packet = {
        [GAME_WS_FIELDS.COMMAND]: GAME_WS_COMMANDS.GET_TOP_PLAYERS,
        [GAME_WS_FIELDS.PACKET_INDEX]: String(game.gameWsNextPacketIndex++),
        [GAME_WS_FIELDS.OUTCOMING_PAYLOAD]: {
            start,
            end,
        },
    };

    game.gameWsSend(packet, async (bot, payload) => {
        resolve(payload);
    });
}); }
